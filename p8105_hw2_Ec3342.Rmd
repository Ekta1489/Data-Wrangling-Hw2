---
title: "p8105_hw2_Ec3342"
author: "Ekta Chaudhary"
date: "30/09/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(readxl)
library(dplyr)

```

# Question 1

## Reading and cleaning the Mr. Trash Wheel sheet. 
#Mentioned the path to the xlsx file using path = "./data/Trash_wheet_data.xlsx", specified the sheet to read by providing the name of the sheet which is Mr. Trash Wheel here. Cleaned the variable names so that they are reasonable, omitted the rows that do not include dumpster-specific data, rounded the number of sports balls to the nearest integer.

```{r trashwheel_data}
trashwheel_data = 
  read_excel(
    path = "./data/Trash_wheet_data.xlsx", 
    sheet = "Mr. Trash Wheel"
  ) %>%
  janitor::clean_names() %>%
  drop_na(., dumpster) %>%
  mutate(
    sports_balls = as.integer(sports_balls)
    )
```

## Reading and cleaning the precipitation data for 2017 and 2018. 
#Omitted the rows without precipitation data and added a variable year which is = 2017 for precipitaion_data_2017 and 2018 for precipitation_data_2018.Combined both the precipitation data (precipitation_data_2017 and precipitation_data_2018) to form combined_data. In the combined_data used month.name to convert the month from numeric to character variable.

```{r precipitation_data}
precipitation_data_2017 =
  read_excel(
    path = "./data/Trash_wheet_data.xlsx",
    sheet = "2017 Precipitation", 
    skip = 1
    ) %>%
  janitor::clean_names() %>%
  drop_na() %>%
  mutate(
    year = 2017
    )

precipitation_data_2018 =
  read_excel(
    path = "./data/Trash_wheet_data.xlsx",
    sheet = "2018 Precipitation",
    skip = 1
    ) %>%
  janitor::clean_names() %>%
  drop_na() %>%
  mutate(
    year = 2018
    )

combined_data = union_all(
  precipitation_data_2017, precipitation_data_2018
  ) %>%
  mutate(
    month = month.name[month] 
    )
```
## Describing both the datasets!
*The number of observations in trashwheel_data is `r nrow(trashwheel_data)`
*The number of observations in combined_data is `r nrow(combined_data)`
(The number of observations in precipitation_data_2017 is `r nrow(precipitation_data_2017)`,
The number of observations in precipitation_data_2018 is `r nrow(precipitation_data_2018)`) 
*The key variables would be month, year, total. 
*The total precipitation in 2018 was `r sum(pull(precipitation_data_2018, total))`
*The median number of sports ball in a dumpster in 2017 was `r trashwheel_data %>% select(sports_balls, year) %>% filter(year == 2017) %>% summarise(median = median(sports_balls))`

# Question 2

##First reading the datasets pols-month.csv and cleaning the data in pols-month.csv. Used separate() to break up the variable mon into integer variables year, month, and day; replaced month number with month name; created a president variable taking values gop and dem, and removed prez_dem and prez_gop; and removed the day variable.

```{r pols_data}
pols_data = 
  read_csv(file = "./data/pols-month.csv") %>%
  janitor::clean_names() %>%
  separate(
    col = mon, into = c("year", "month", "day")) %>% 
  select(
    prez_gop, prez_dem, everything()
  ) %>%
  pivot_longer(
    prez_gop:prez_dem, names_to = "president", names_prefix = "prez_") %>%
  mutate(
   month = as.numeric(month),
   month = month.abb[month]
  ) %>%
  select(
    -day
  )
```

##Cleaning the data in snp.csv using a similar process to the above. For consistency across datasets, arranging according to year and month, and organizing so that year and month are the leading columns.

```{r snp_data}
snp_data =
  read_csv(file = "./data/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(
  col = date, into = c("month", "day", "year")) %>% 
  arrange(
  as.integer(year), as.integer(month)) %>%
  select(
     year, month, close) %>%
  mutate(
    month = as.numeric(month),
    month = month.abb[month]
    ) 
```
##Tidying the unemployment data so that it can be merged with the previous datasets

```{r unemployment_data}
unemployment_data =
  read_csv(file = "./data/unemployment.csv") %>%
  janitor::clean_names() %>%
  pivot_longer(
    jan:dec, names_to = "month", values_to = "rate") %>%
  mutate(
    year = as.character(year)) %>%
  select(
    year, month, everything()
  )
```

##merged_data is formed by joining snp into pols using year and month as keys. final_merged_data is formed by joining the merged_data with unemployment_data using year and month as keys.

```{r merged_data}
merged_data =
  left_join(
    snp_data, pols_data, by = c("year","month"))

final_merged_data =
  left_join(
    merged_data, unemployment_data, by = c("year","month"))
```

# Question 3



